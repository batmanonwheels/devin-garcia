<canvas class="w-full h-[calc(10svh)]" id="canvas"></canvas>
<audio id="player" controls preload="auto" src="https://stream.devingarcia.net/stream.ogg" crossorigin="anonymous">
</audio>

<!-- <script defer>
  const player = document.querySelector("audio");
  const canvas = document.querySelector("canvas"
  )

  const canvasCtx = canvas.getContext("2d");
  const width = canvas.width
  const height = canvas.height



  player.addEventListener("play", async (e) => {
    let audioCtx = new (window.AudioContext || window.webkitAudioContext)()
    let src = audioCtx.createMediaElementSource(player);
    const analyser = audioCtx.createAnalyser();

    src.connect(analyser);
    analyser.connect(audioCtx.destination)

    analyser.fftSize = 64;
    const bufferLength = analyser.frequencyBinCount;
    const dataArray = new Uint8Array(bufferLength);

    const visualize = () => {
      requestAnimationFrame(visualize)
      analyser.getByteFrequencyData(dataArray)

      canvasCtx.fillStyle = "rgb(255, 255, 255)"
      canvasCtx.fillRect(0, 0, width, height);

      const barWidth = (width / bufferLength);
      let barHeight;
      let x = 10;

      for (let i = 0; i < bufferLength; i++) {
        barHeight = dataArray[i] / 2
        console.log(dataArray[i] / 2, height)

        // canvasCtx.fillStyle = `rgb(${barHeight - 100} ${barHeight - 100} ${barHeight - 100})`;
        // canvasCtx.fillRect(x, height / 2, barWidth / 1.75, barHeight / 2);

        // canvasCtx.fillStyle = `rgb(${barHeight - 100} ${barHeight - 100} ${barHeight - 100})`;
        // canvasCtx.fillRect(x, height / 2, barWidth / 1.75, -barHeight / 2);

        canvasCtx.fillStyle = `rgb(0, 0, 0)`;
        canvasCtx.fill()
        canvasCtx.beginPath();
        canvasCtx.roundRect(x, height / 2, barWidth / 5, -barHeight / 2, [, 0, 30, 30]);
        canvasCtx.stroke();

        canvasCtx.fillStyle = `rgb(0, 0, 0)`;
        canvasCtx.fill()
        canvasCtx.beginPath();
        canvasCtx.roundRect(x, height / 2, barWidth / 5, barHeight / 2, [0, 0, 30, 30]);
        canvasCtx.stroke();


        x += barWidth;
      }

      // const barWidth = (width / bufferLength);
      // let barHeight;
      // let x = 0;

      // for (let i = 3; i < bufferLength; i++) {
      //   barHeight = dataArray[i] < 5 ? 5 : dataArray[i];

      //   canvasCtx.fillStyle = `rgb(${barHeight + 100} 0 0)`;
      //   canvasCtx.fillRect(x, height / 2, barWidth, barHeight / 2);

      //   canvasCtx.fillStyle = `rgb(${barHeight + 100} 0 0)`;
      //   canvasCtx.fillRect(x, height / 2, barWidth, -barHeight / 2);

      //   x += barWidth;
      // }
    }

    visualize()
  })

</script> -->